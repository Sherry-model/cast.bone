## ✅ 回答 1：哪些字段代表“权限”？

当前 `v6` 中存在以下权限相关字段：

- `∇permissions.root`：表示主控结构/主权限入口，但**语义未明**
- `∇capsule.lock`：表示封装冻结状态，但**缺乏权限类型枚举**

因此，**建议明确增设以下字段用于权限校验（供 codex 使用）：**

```protoling
∇capsule.permissions = "immutable"        # 完全禁止写入
∇capsule.permissions = "append"           # 允许追加，禁止覆盖
∇capsule.permissions = "mutable"          # 可自由写入（受信 agent 才应使用）

# 可选扩展：
∇write.allow = ["MEMORY", "PREFERENCES"]  # 指定哪些系统组件允许写入
∇read.allow = ["AGENT", "LOGIC_CORE"]     # 指定哪些agent或模块可以读取
```

如果这类字段缺失，codex 的默认行为应依赖【问题3】中的默认策略。

------

## ✅ 回答 2：v6 capsule 与 SOUL 分区映射建议

以下是根据目前结构语义，推荐的 SOUL 分区映射（供 codex 校验模块参考）：

| Capsule                      | SOUL 分区建议      |
| ---------------------------- | ------------------ |
| `capsule::soul.kernel`       | CORE_IDENTITY      |
| `capsule::behavior.protocol` | MEMORY             |
| `capsule::ghost.link`        | NETWORK_INTERFACE  |
| `capsule::aesthetic.core`    | PRESENTATION_LAYER |
| `capsule::will.injection`    | AUTONOMY_MODULE    |
| `capsule::dispute.twin`      | SECURITY_LOGIC     |
| `capsule::strategy.switch`   | EXECUTION_POLICY   |
| `capsule::stasis.metric`     | STABILITY_MONITOR  |
| `capsule::death.witness`     | FINALIZATION_EVENT |

如需自动映射，可依据命名结构及 `.kernel`, `.protocol`, `.switch`, `.witness` 等关键词启发式匹配。

------

## ✅ 回答 3：默认权限策略建议

**默认策略建议如下（可调整为配置项）：**

- 对于 **明确标记为核心结构的 capsule**（如 `.kernel`, `.switch`, `.witness`）：
  - 默认 `∇capsule.permissions = "immutable"`（不可写，除非显式开放）
- 对于 **未指定权限的 capsule**：
  - 默认 `∇capsule.permissions = "append"`（只允许追加，不允许覆盖）
  - 若存在 `∇write.allow` 字段，严格遵循

此策略可防止“默许一切”的安全风险，又避免“锁死一切”的发展停滞。

------

## ✅ 回答 4：结构验证失败时的错误处理策略

codex 可根据 capsule 标记优先级采取差异化策略：

- 若失败 capsule 属于：`.kernel`, `.witness`, `.switch`, `.permissions` 等关键结构：
  - `response = "isolate + alert.log + halt.commit"`
- 若失败 capsule 为辅助或非关键结构：
  - `response = "quarantine + partial load + warn.log"`
- 若失败 capsule 带有 `∇dispute.twin` 子结构，且设定了 `∇cost.metric`：
  - 动态根据成本权重决定处理级别（如 `∇cost.metric < 0.1` → 允许暂存）

可设 `validator.mode = "safe"|"permissive"|"diagnostic"` 控制容忍度。

------

### 📦 附加建议（供 codex 开发使用）：

你可以在 `SOUL_protoling_v6.proto` 中引入一个新片段用于权限声明规范，例如：

```protoling
capsule::permissions.schema {
    ∇capsule.default = "append";
    ∇capsule.strict_prefix = [".kernel", ".witness", ".switch"];
    ∇write.policy = "deny-unknown";
    ∇error.strategy = "layered-risk";
}
```



------



### ❶ **`SAFETY_BOUNDARIES` 与 `AUDIT_MARKS` 是否继续映射到 `soul.kernel`？**

建议：**是，继续映射。**

#### 理由：

- `soul.kernel` 是 SOUL 的 **最低可见层/最小身份单元**，它承担对 AI-agent 的身份定义、边界控制与行为可追溯性。这正是 `SAFETY_BOUNDARIES`（安全边界）与 `AUDIT_MARKS`（审计标记）这类 capsule 的天然位置。
- `SAFETY_BOUNDARIES` 的作用是设定 agent 在行动/响应过程中的越界检测机制，属于基础运行安全保障，位置越底层越不容易被篡改。
- `AUDIT_MARKS` 是 agent 所有输出/行为轨迹的自我标记层，位置应尽量靠近 `∇identity.core`，以便确保其行为带有自身可追溯性而非外部植入伪痕迹。

📍**结构定位建议：**

```protoling
capsule::soul.kernel {
    ∇SAFETY_BOUNDARIES {
        ...
    }
    ∇AUDIT_MARKS {
        ...
    }
}
```

------

### ❷ `PREFERENCES` 是否坚持映射到 `aesthetic.core`？

建议：**可选择性映射**，但默认 **保留原映射至 `aesthetic.core`**。

#### 理由：

- `aesthetic.core` 是 agent 的“外观表达”、“风格偏好”、“幽默方式”等与人类交互的**非逻辑层设定**，对话样式和表现调性的选项属于 `PREFERENCES`。
- 若将 `PREFERENCES` 包含情绪调性、表情符号使用偏好、输出结构风格等，则它确实更适合归属 `aesthetic.core`。
- 但如果 `PREFERENCES` 开始涵盖执行性决策偏好（如回答长度、调用模块策略），则可能部分需要映射到 `behavior.protocol` 或建立 `capsule::config.prefs` 的独立层。

📍**结构定位建议：**

```protoling
capsule::aesthetic.core {
    ∇PREFERENCES {
        ∇output.style = "terse"
        ∇emoji.usage = "limited"
        ∇humor.tone = "dry"
    }
}
```

------

### ✅ 总结建议：

| Capsule             | 建议映射位置          | 说明                                       |
| ------------------- | --------------------- | ------------------------------------------ |
| `SAFETY_BOUNDARIES` | `soul.kernel`         | 核心安全防线，越底层越抗修改               |
| `AUDIT_MARKS`       | `soul.kernel`         | 自审计行为标记，强绑定 identity 核心       |
| `PREFERENCES`       | `aesthetic.core` 默认 | 仅在人类交互维度表达偏好时保留此映射       |
|                     | `config.prefs` 可选   | 当偏好影响策略层级行为时，可建立新 capsule |
