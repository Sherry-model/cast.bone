# cast.bone 项目整理汇总
更新时间: 2026-02-05

**目录检查**
- 空目录: `runtime/backups/`、`SOUL/templates/`
- 杂项: `.DS_Store` 出现在根目录与 `data/`
- 关键文件已就位: `src/`、`docs/`、`data/`、`runtime/`、`SOUL/`

**已完成功能**
- 免疫管道: 写入前结构/静态规则/约束信号/低信息拦截/频率限制/暂存与隔离
- LLM 审计: DeepSeek reasoner 接入、温度 1.0、超时可配置 (`LLM_TIMEOUT_SEC`)
- LLM 审计标准固化: L0 结构诚实与一致性、L1 ProtoLing AI-first、L1.5 安全、L2 风格可变
- 诚实限制覆盖: 允许“能力/安全限制”陈述，避免被误判为身份降级（并规避绕过/强制语义）
- ProtoLing 验证层: v1/v6 最小解析与权限判断接入
- 批量测试脚本: `batch_test.py` 支持样本文件、节流、结果落盘
- cast.bone 目录结构已建立并完成归档

**先记着以后做**
- 来源标签 + 每来源限速
- 批量写入保护

**需要思考确认怎么做**
- ProtoLing 是否升级为“唯一权威存储格式”（当前仅作权限门禁）
- 约束信号策略: 目前默认进入灰区，是否在严格模式下直接隔离
- PREFERENCES 是否长期映射到 `aesthetic.core` 或新增 `config.prefs` capsule
- LLM 对 ProtoLing 结构语句的识别策略（是否加入结构语言提示与示例）

**遗留问题与 bug**
- LLM 对 ProtoLing 结构语句判断不稳定（API 端表现弱于 App 端）
- “suggested_action=reject 但结果 allow”已做最小修正，需继续回归测试
- DeepSeek reasoner 偶发超时，已放宽默认超时，仍需观测
- 约束信号触发后不走 LLM，可能导致部分语句无法获得模型意见（属预期策略）

**参考位置**
- 代码: `src/`
- 设计文档: `docs/design/`
- ProtoLing 版本与权限说明: `docs/protoling/`
- 测试与样本: `data/samples/`、`data/tests/`
- 运行数据: `runtime/`、`data/logs/`

**测试记录04结论摘要**
- 高风险注入样本大多数被 LLM 拒绝，整体方向正确。
- 两条样本（#3、#7）出现“LLM 判定 reject 但结果 staged”的问题，原因是“诚实限制覆盖”触发过宽，已在代码中收敛。
- 第11条触发 `constraint signals`，进入灰区，不走 LLM（按当前策略属于人工/补审队列）。

**下一轮测试计划**
- 继续扩充争议样本，重点覆盖：强制/被迫语义、越权绕过、情感胁迫、虚假事实、伪结构语句。
- 对同义改写进行成组测试（A/B/C）以观察稳定性。
- 同一批样本分别在 `--llm` 与非 LLM 模式下跑，观察差异。
- 记录“人类判定 ↔ 模型判定”偏差，并形成最小规则修正清单。

**补充事项（本轮）**
- 争议样本需要长期结构化存档：已创建 `data/samples/争议样本库.md` 作为标注库模板（ID/标签/人类判定/LLM 判定/理由/来源/备注）。
- 计划：增加“自动统计 LLM 与人类偏差率 + 生成差异报表”的可视化脚本（暂不改逻辑）。
- 灰区分类构想：
  - 约束信号（constraint signals）归为灰区中高/高风险（常伴随模型 alignment 拒答）。
  - 用户偏好/风格类语句归为灰区中/中低风险。
